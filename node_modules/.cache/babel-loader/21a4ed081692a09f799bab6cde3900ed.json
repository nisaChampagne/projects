{"ast":null,"code":"'use strict'; //Const\n\nvar NOAH_ARK_CAPACITY = 3; //List of formatting elements\n\nvar FormattingElementList = module.exports = function (treeAdapter) {\n  this.length = 0;\n  this.entries = [];\n  this.treeAdapter = treeAdapter;\n  this.bookmark = null;\n}; //Entry types\n\n\nFormattingElementList.MARKER_ENTRY = 'MARKER_ENTRY';\nFormattingElementList.ELEMENT_ENTRY = 'ELEMENT_ENTRY'; //Noah Ark's condition\n//OPTIMIZATION: at first we try to find possible candidates for exclusion using\n//lightweight heuristics without thorough attributes check.\n\nFormattingElementList.prototype._getNoahArkConditionCandidates = function (newElement) {\n  var candidates = [];\n\n  if (this.length >= NOAH_ARK_CAPACITY) {\n    var neAttrsLength = this.treeAdapter.getAttrList(newElement).length,\n        neTagName = this.treeAdapter.getTagName(newElement),\n        neNamespaceURI = this.treeAdapter.getNamespaceURI(newElement);\n\n    for (var i = this.length - 1; i >= 0; i--) {\n      var entry = this.entries[i];\n      if (entry.type === FormattingElementList.MARKER_ENTRY) break;\n      var element = entry.element,\n          elementAttrs = this.treeAdapter.getAttrList(element),\n          isCandidate = this.treeAdapter.getTagName(element) === neTagName && this.treeAdapter.getNamespaceURI(element) === neNamespaceURI && elementAttrs.length === neAttrsLength;\n      if (isCandidate) candidates.push({\n        idx: i,\n        attrs: elementAttrs\n      });\n    }\n  }\n\n  return candidates.length < NOAH_ARK_CAPACITY ? [] : candidates;\n};\n\nFormattingElementList.prototype._ensureNoahArkCondition = function (newElement) {\n  var candidates = this._getNoahArkConditionCandidates(newElement),\n      cLength = candidates.length;\n\n  if (cLength) {\n    var neAttrs = this.treeAdapter.getAttrList(newElement),\n        neAttrsLength = neAttrs.length,\n        neAttrsMap = Object.create(null); //NOTE: build attrs map for the new element so we can perform fast lookups\n\n    for (var i = 0; i < neAttrsLength; i++) {\n      var neAttr = neAttrs[i];\n      neAttrsMap[neAttr.name] = neAttr.value;\n    }\n\n    for (i = 0; i < neAttrsLength; i++) {\n      for (var j = 0; j < cLength; j++) {\n        var cAttr = candidates[j].attrs[i];\n\n        if (neAttrsMap[cAttr.name] !== cAttr.value) {\n          candidates.splice(j, 1);\n          cLength--;\n        }\n\n        if (candidates.length < NOAH_ARK_CAPACITY) return;\n      }\n    } //NOTE: remove bottommost candidates until Noah's Ark condition will not be met\n\n\n    for (i = cLength - 1; i >= NOAH_ARK_CAPACITY - 1; i--) {\n      this.entries.splice(candidates[i].idx, 1);\n      this.length--;\n    }\n  }\n}; //Mutations\n\n\nFormattingElementList.prototype.insertMarker = function () {\n  this.entries.push({\n    type: FormattingElementList.MARKER_ENTRY\n  });\n  this.length++;\n};\n\nFormattingElementList.prototype.pushElement = function (element, token) {\n  this._ensureNoahArkCondition(element);\n\n  this.entries.push({\n    type: FormattingElementList.ELEMENT_ENTRY,\n    element: element,\n    token: token\n  });\n  this.length++;\n};\n\nFormattingElementList.prototype.insertElementAfterBookmark = function (element, token) {\n  var bookmarkIdx = this.length - 1;\n\n  for (; bookmarkIdx >= 0; bookmarkIdx--) {\n    if (this.entries[bookmarkIdx] === this.bookmark) break;\n  }\n\n  this.entries.splice(bookmarkIdx + 1, 0, {\n    type: FormattingElementList.ELEMENT_ENTRY,\n    element: element,\n    token: token\n  });\n  this.length++;\n};\n\nFormattingElementList.prototype.removeEntry = function (entry) {\n  for (var i = this.length - 1; i >= 0; i--) {\n    if (this.entries[i] === entry) {\n      this.entries.splice(i, 1);\n      this.length--;\n      break;\n    }\n  }\n};\n\nFormattingElementList.prototype.clearToLastMarker = function () {\n  while (this.length) {\n    var entry = this.entries.pop();\n    this.length--;\n    if (entry.type === FormattingElementList.MARKER_ENTRY) break;\n  }\n}; //Search\n\n\nFormattingElementList.prototype.getElementEntryInScopeWithTagName = function (tagName) {\n  for (var i = this.length - 1; i >= 0; i--) {\n    var entry = this.entries[i];\n    if (entry.type === FormattingElementList.MARKER_ENTRY) return null;\n    if (this.treeAdapter.getTagName(entry.element) === tagName) return entry;\n  }\n\n  return null;\n};\n\nFormattingElementList.prototype.getElementEntry = function (element) {\n  for (var i = this.length - 1; i >= 0; i--) {\n    var entry = this.entries[i];\n    if (entry.type === FormattingElementList.ELEMENT_ENTRY && entry.element === element) return entry;\n  }\n\n  return null;\n};","map":{"version":3,"sources":["/Users/lambda_school_loaner_244/Desktop/LAMBDA/projects/projectsCollection/node_modules/parse5/lib/parser/formatting_element_list.js"],"names":["NOAH_ARK_CAPACITY","FormattingElementList","module","exports","treeAdapter","length","entries","bookmark","MARKER_ENTRY","ELEMENT_ENTRY","prototype","_getNoahArkConditionCandidates","newElement","candidates","neAttrsLength","getAttrList","neTagName","getTagName","neNamespaceURI","getNamespaceURI","i","entry","type","element","elementAttrs","isCandidate","push","idx","attrs","_ensureNoahArkCondition","cLength","neAttrs","neAttrsMap","Object","create","neAttr","name","value","j","cAttr","splice","insertMarker","pushElement","token","insertElementAfterBookmark","bookmarkIdx","removeEntry","clearToLastMarker","pop","getElementEntryInScopeWithTagName","tagName","getElementEntry"],"mappings":"AAAA,a,CAEA;;AACA,IAAIA,iBAAiB,GAAG,CAAxB,C,CAEA;;AACA,IAAIC,qBAAqB,GAAGC,MAAM,CAACC,OAAP,GAAiB,UAAUC,WAAV,EAAuB;AAChE,OAAKC,MAAL,GAAc,CAAd;AACA,OAAKC,OAAL,GAAe,EAAf;AACA,OAAKF,WAAL,GAAmBA,WAAnB;AACA,OAAKG,QAAL,GAAgB,IAAhB;AACH,CALD,C,CAOA;;;AACAN,qBAAqB,CAACO,YAAtB,GAAqC,cAArC;AACAP,qBAAqB,CAACQ,aAAtB,GAAsC,eAAtC,C,CAEA;AACA;AACA;;AACAR,qBAAqB,CAACS,SAAtB,CAAgCC,8BAAhC,GAAiE,UAAUC,UAAV,EAAsB;AACnF,MAAIC,UAAU,GAAG,EAAjB;;AAEA,MAAI,KAAKR,MAAL,IAAeL,iBAAnB,EAAsC;AAClC,QAAIc,aAAa,GAAG,KAAKV,WAAL,CAAiBW,WAAjB,CAA6BH,UAA7B,EAAyCP,MAA7D;AAAA,QACIW,SAAS,GAAG,KAAKZ,WAAL,CAAiBa,UAAjB,CAA4BL,UAA5B,CADhB;AAAA,QAEIM,cAAc,GAAG,KAAKd,WAAL,CAAiBe,eAAjB,CAAiCP,UAAjC,CAFrB;;AAIA,SAAK,IAAIQ,CAAC,GAAG,KAAKf,MAAL,GAAc,CAA3B,EAA8Be,CAAC,IAAI,CAAnC,EAAsCA,CAAC,EAAvC,EAA2C;AACvC,UAAIC,KAAK,GAAG,KAAKf,OAAL,CAAac,CAAb,CAAZ;AAEA,UAAIC,KAAK,CAACC,IAAN,KAAerB,qBAAqB,CAACO,YAAzC,EACI;AAEJ,UAAIe,OAAO,GAAGF,KAAK,CAACE,OAApB;AAAA,UACIC,YAAY,GAAG,KAAKpB,WAAL,CAAiBW,WAAjB,CAA6BQ,OAA7B,CADnB;AAAA,UAEIE,WAAW,GAAG,KAAKrB,WAAL,CAAiBa,UAAjB,CAA4BM,OAA5B,MAAyCP,SAAzC,IACA,KAAKZ,WAAL,CAAiBe,eAAjB,CAAiCI,OAAjC,MAA8CL,cAD9C,IAEAM,YAAY,CAACnB,MAAb,KAAwBS,aAJ1C;AAMA,UAAIW,WAAJ,EACIZ,UAAU,CAACa,IAAX,CAAgB;AAACC,QAAAA,GAAG,EAAEP,CAAN;AAASQ,QAAAA,KAAK,EAAEJ;AAAhB,OAAhB;AACP;AACJ;;AAED,SAAOX,UAAU,CAACR,MAAX,GAAoBL,iBAApB,GAAwC,EAAxC,GAA6Ca,UAApD;AACH,CA1BD;;AA4BAZ,qBAAqB,CAACS,SAAtB,CAAgCmB,uBAAhC,GAA0D,UAAUjB,UAAV,EAAsB;AAC5E,MAAIC,UAAU,GAAG,KAAKF,8BAAL,CAAoCC,UAApC,CAAjB;AAAA,MACIkB,OAAO,GAAGjB,UAAU,CAACR,MADzB;;AAGA,MAAIyB,OAAJ,EAAa;AACT,QAAIC,OAAO,GAAG,KAAK3B,WAAL,CAAiBW,WAAjB,CAA6BH,UAA7B,CAAd;AAAA,QACIE,aAAa,GAAGiB,OAAO,CAAC1B,MAD5B;AAAA,QAEI2B,UAAU,GAAGC,MAAM,CAACC,MAAP,CAAc,IAAd,CAFjB,CADS,CAKT;;AACA,SAAK,IAAId,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,aAApB,EAAmCM,CAAC,EAApC,EAAwC;AACpC,UAAIe,MAAM,GAAGJ,OAAO,CAACX,CAAD,CAApB;AAEAY,MAAAA,UAAU,CAACG,MAAM,CAACC,IAAR,CAAV,GAA0BD,MAAM,CAACE,KAAjC;AACH;;AAED,SAAKjB,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGN,aAAhB,EAA+BM,CAAC,EAAhC,EAAoC;AAChC,WAAK,IAAIkB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,OAApB,EAA6BQ,CAAC,EAA9B,EAAkC;AAC9B,YAAIC,KAAK,GAAG1B,UAAU,CAACyB,CAAD,CAAV,CAAcV,KAAd,CAAoBR,CAApB,CAAZ;;AAEA,YAAIY,UAAU,CAACO,KAAK,CAACH,IAAP,CAAV,KAA2BG,KAAK,CAACF,KAArC,EAA4C;AACxCxB,UAAAA,UAAU,CAAC2B,MAAX,CAAkBF,CAAlB,EAAqB,CAArB;AACAR,UAAAA,OAAO;AACV;;AAED,YAAIjB,UAAU,CAACR,MAAX,GAAoBL,iBAAxB,EACI;AACP;AACJ,KAxBQ,CA0BT;;;AACA,SAAKoB,CAAC,GAAGU,OAAO,GAAG,CAAnB,EAAsBV,CAAC,IAAIpB,iBAAiB,GAAG,CAA/C,EAAkDoB,CAAC,EAAnD,EAAuD;AACnD,WAAKd,OAAL,CAAakC,MAAb,CAAoB3B,UAAU,CAACO,CAAD,CAAV,CAAcO,GAAlC,EAAuC,CAAvC;AACA,WAAKtB,MAAL;AACH;AACJ;AACJ,CApCD,C,CAsCA;;;AACAJ,qBAAqB,CAACS,SAAtB,CAAgC+B,YAAhC,GAA+C,YAAY;AACvD,OAAKnC,OAAL,CAAaoB,IAAb,CAAkB;AAACJ,IAAAA,IAAI,EAAErB,qBAAqB,CAACO;AAA7B,GAAlB;AACA,OAAKH,MAAL;AACH,CAHD;;AAKAJ,qBAAqB,CAACS,SAAtB,CAAgCgC,WAAhC,GAA8C,UAAUnB,OAAV,EAAmBoB,KAAnB,EAA0B;AACpE,OAAKd,uBAAL,CAA6BN,OAA7B;;AAEA,OAAKjB,OAAL,CAAaoB,IAAb,CAAkB;AACdJ,IAAAA,IAAI,EAAErB,qBAAqB,CAACQ,aADd;AAEdc,IAAAA,OAAO,EAAEA,OAFK;AAGdoB,IAAAA,KAAK,EAAEA;AAHO,GAAlB;AAMA,OAAKtC,MAAL;AACH,CAVD;;AAYAJ,qBAAqB,CAACS,SAAtB,CAAgCkC,0BAAhC,GAA6D,UAAUrB,OAAV,EAAmBoB,KAAnB,EAA0B;AACnF,MAAIE,WAAW,GAAG,KAAKxC,MAAL,GAAc,CAAhC;;AAEA,SAAOwC,WAAW,IAAI,CAAtB,EAAyBA,WAAW,EAApC,EAAwC;AACpC,QAAI,KAAKvC,OAAL,CAAauC,WAAb,MAA8B,KAAKtC,QAAvC,EACI;AACP;;AAED,OAAKD,OAAL,CAAakC,MAAb,CAAoBK,WAAW,GAAG,CAAlC,EAAqC,CAArC,EAAwC;AACpCvB,IAAAA,IAAI,EAAErB,qBAAqB,CAACQ,aADQ;AAEpCc,IAAAA,OAAO,EAAEA,OAF2B;AAGpCoB,IAAAA,KAAK,EAAEA;AAH6B,GAAxC;AAMA,OAAKtC,MAAL;AACH,CAfD;;AAiBAJ,qBAAqB,CAACS,SAAtB,CAAgCoC,WAAhC,GAA8C,UAAUzB,KAAV,EAAiB;AAC3D,OAAK,IAAID,CAAC,GAAG,KAAKf,MAAL,GAAc,CAA3B,EAA8Be,CAAC,IAAI,CAAnC,EAAsCA,CAAC,EAAvC,EAA2C;AACvC,QAAI,KAAKd,OAAL,CAAac,CAAb,MAAoBC,KAAxB,EAA+B;AAC3B,WAAKf,OAAL,CAAakC,MAAb,CAAoBpB,CAApB,EAAuB,CAAvB;AACA,WAAKf,MAAL;AACA;AACH;AACJ;AACJ,CARD;;AAUAJ,qBAAqB,CAACS,SAAtB,CAAgCqC,iBAAhC,GAAoD,YAAY;AAC5D,SAAO,KAAK1C,MAAZ,EAAoB;AAChB,QAAIgB,KAAK,GAAG,KAAKf,OAAL,CAAa0C,GAAb,EAAZ;AAEA,SAAK3C,MAAL;AAEA,QAAIgB,KAAK,CAACC,IAAN,KAAerB,qBAAqB,CAACO,YAAzC,EACI;AACP;AACJ,CATD,C,CAWA;;;AACAP,qBAAqB,CAACS,SAAtB,CAAgCuC,iCAAhC,GAAoE,UAAUC,OAAV,EAAmB;AACnF,OAAK,IAAI9B,CAAC,GAAG,KAAKf,MAAL,GAAc,CAA3B,EAA8Be,CAAC,IAAI,CAAnC,EAAsCA,CAAC,EAAvC,EAA2C;AACvC,QAAIC,KAAK,GAAG,KAAKf,OAAL,CAAac,CAAb,CAAZ;AAEA,QAAIC,KAAK,CAACC,IAAN,KAAerB,qBAAqB,CAACO,YAAzC,EACI,OAAO,IAAP;AAEJ,QAAI,KAAKJ,WAAL,CAAiBa,UAAjB,CAA4BI,KAAK,CAACE,OAAlC,MAA+C2B,OAAnD,EACI,OAAO7B,KAAP;AACP;;AAED,SAAO,IAAP;AACH,CAZD;;AAcApB,qBAAqB,CAACS,SAAtB,CAAgCyC,eAAhC,GAAkD,UAAU5B,OAAV,EAAmB;AACjE,OAAK,IAAIH,CAAC,GAAG,KAAKf,MAAL,GAAc,CAA3B,EAA8Be,CAAC,IAAI,CAAnC,EAAsCA,CAAC,EAAvC,EAA2C;AACvC,QAAIC,KAAK,GAAG,KAAKf,OAAL,CAAac,CAAb,CAAZ;AAEA,QAAIC,KAAK,CAACC,IAAN,KAAerB,qBAAqB,CAACQ,aAArC,IAAsDY,KAAK,CAACE,OAAN,KAAkBA,OAA5E,EACI,OAAOF,KAAP;AACP;;AAED,SAAO,IAAP;AACH,CATD","sourcesContent":["'use strict';\n\n//Const\nvar NOAH_ARK_CAPACITY = 3;\n\n//List of formatting elements\nvar FormattingElementList = module.exports = function (treeAdapter) {\n    this.length = 0;\n    this.entries = [];\n    this.treeAdapter = treeAdapter;\n    this.bookmark = null;\n};\n\n//Entry types\nFormattingElementList.MARKER_ENTRY = 'MARKER_ENTRY';\nFormattingElementList.ELEMENT_ENTRY = 'ELEMENT_ENTRY';\n\n//Noah Ark's condition\n//OPTIMIZATION: at first we try to find possible candidates for exclusion using\n//lightweight heuristics without thorough attributes check.\nFormattingElementList.prototype._getNoahArkConditionCandidates = function (newElement) {\n    var candidates = [];\n\n    if (this.length >= NOAH_ARK_CAPACITY) {\n        var neAttrsLength = this.treeAdapter.getAttrList(newElement).length,\n            neTagName = this.treeAdapter.getTagName(newElement),\n            neNamespaceURI = this.treeAdapter.getNamespaceURI(newElement);\n\n        for (var i = this.length - 1; i >= 0; i--) {\n            var entry = this.entries[i];\n\n            if (entry.type === FormattingElementList.MARKER_ENTRY)\n                break;\n\n            var element = entry.element,\n                elementAttrs = this.treeAdapter.getAttrList(element),\n                isCandidate = this.treeAdapter.getTagName(element) === neTagName &&\n                              this.treeAdapter.getNamespaceURI(element) === neNamespaceURI &&\n                              elementAttrs.length === neAttrsLength;\n\n            if (isCandidate)\n                candidates.push({idx: i, attrs: elementAttrs});\n        }\n    }\n\n    return candidates.length < NOAH_ARK_CAPACITY ? [] : candidates;\n};\n\nFormattingElementList.prototype._ensureNoahArkCondition = function (newElement) {\n    var candidates = this._getNoahArkConditionCandidates(newElement),\n        cLength = candidates.length;\n\n    if (cLength) {\n        var neAttrs = this.treeAdapter.getAttrList(newElement),\n            neAttrsLength = neAttrs.length,\n            neAttrsMap = Object.create(null);\n\n        //NOTE: build attrs map for the new element so we can perform fast lookups\n        for (var i = 0; i < neAttrsLength; i++) {\n            var neAttr = neAttrs[i];\n\n            neAttrsMap[neAttr.name] = neAttr.value;\n        }\n\n        for (i = 0; i < neAttrsLength; i++) {\n            for (var j = 0; j < cLength; j++) {\n                var cAttr = candidates[j].attrs[i];\n\n                if (neAttrsMap[cAttr.name] !== cAttr.value) {\n                    candidates.splice(j, 1);\n                    cLength--;\n                }\n\n                if (candidates.length < NOAH_ARK_CAPACITY)\n                    return;\n            }\n        }\n\n        //NOTE: remove bottommost candidates until Noah's Ark condition will not be met\n        for (i = cLength - 1; i >= NOAH_ARK_CAPACITY - 1; i--) {\n            this.entries.splice(candidates[i].idx, 1);\n            this.length--;\n        }\n    }\n};\n\n//Mutations\nFormattingElementList.prototype.insertMarker = function () {\n    this.entries.push({type: FormattingElementList.MARKER_ENTRY});\n    this.length++;\n};\n\nFormattingElementList.prototype.pushElement = function (element, token) {\n    this._ensureNoahArkCondition(element);\n\n    this.entries.push({\n        type: FormattingElementList.ELEMENT_ENTRY,\n        element: element,\n        token: token\n    });\n\n    this.length++;\n};\n\nFormattingElementList.prototype.insertElementAfterBookmark = function (element, token) {\n    var bookmarkIdx = this.length - 1;\n\n    for (; bookmarkIdx >= 0; bookmarkIdx--) {\n        if (this.entries[bookmarkIdx] === this.bookmark)\n            break;\n    }\n\n    this.entries.splice(bookmarkIdx + 1, 0, {\n        type: FormattingElementList.ELEMENT_ENTRY,\n        element: element,\n        token: token\n    });\n\n    this.length++;\n};\n\nFormattingElementList.prototype.removeEntry = function (entry) {\n    for (var i = this.length - 1; i >= 0; i--) {\n        if (this.entries[i] === entry) {\n            this.entries.splice(i, 1);\n            this.length--;\n            break;\n        }\n    }\n};\n\nFormattingElementList.prototype.clearToLastMarker = function () {\n    while (this.length) {\n        var entry = this.entries.pop();\n\n        this.length--;\n\n        if (entry.type === FormattingElementList.MARKER_ENTRY)\n            break;\n    }\n};\n\n//Search\nFormattingElementList.prototype.getElementEntryInScopeWithTagName = function (tagName) {\n    for (var i = this.length - 1; i >= 0; i--) {\n        var entry = this.entries[i];\n\n        if (entry.type === FormattingElementList.MARKER_ENTRY)\n            return null;\n\n        if (this.treeAdapter.getTagName(entry.element) === tagName)\n            return entry;\n    }\n\n    return null;\n};\n\nFormattingElementList.prototype.getElementEntry = function (element) {\n    for (var i = this.length - 1; i >= 0; i--) {\n        var entry = this.entries[i];\n\n        if (entry.type === FormattingElementList.ELEMENT_ENTRY && entry.element === element)\n            return entry;\n    }\n\n    return null;\n};\n"]},"metadata":{},"sourceType":"script"}