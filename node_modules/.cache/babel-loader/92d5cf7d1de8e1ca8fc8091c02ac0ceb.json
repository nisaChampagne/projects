{"ast":null,"code":"'use strict';\n\nvar HTML = require('../common/html'); //Aliases\n\n\nvar $ = HTML.TAG_NAMES,\n    NS = HTML.NAMESPACES; //Element utils\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\n//It's faster than using dictionary.\n\nfunction isImpliedEndTagRequired(tn) {\n  switch (tn.length) {\n    case 1:\n      return tn === $.P;\n\n    case 2:\n      return tn === $.RB || tn === $.RP || tn === $.RT || tn === $.DD || tn === $.DT || tn === $.LI;\n\n    case 3:\n      return tn === $.RTC;\n\n    case 6:\n      return tn === $.OPTION;\n\n    case 8:\n      return tn === $.OPTGROUP || tn === $.MENUITEM;\n  }\n\n  return false;\n}\n\nfunction isScopingElement(tn, ns) {\n  switch (tn.length) {\n    case 2:\n      if (tn === $.TD || tn === $.TH) return ns === NS.HTML;else if (tn === $.MI || tn === $.MO || tn === $.MN || tn === $.MS) return ns === NS.MATHML;\n      break;\n\n    case 4:\n      if (tn === $.HTML) return ns === NS.HTML;else if (tn === $.DESC) return ns === NS.SVG;\n      break;\n\n    case 5:\n      if (tn === $.TABLE) return ns === NS.HTML;else if (tn === $.MTEXT) return ns === NS.MATHML;else if (tn === $.TITLE) return ns === NS.SVG;\n      break;\n\n    case 6:\n      return (tn === $.APPLET || tn === $.OBJECT) && ns === NS.HTML;\n\n    case 7:\n      return (tn === $.CAPTION || tn === $.MARQUEE) && ns === NS.HTML;\n\n    case 8:\n      return tn === $.TEMPLATE && ns === NS.HTML;\n\n    case 13:\n      return tn === $.FOREIGN_OBJECT && ns === NS.SVG;\n\n    case 14:\n      return tn === $.ANNOTATION_XML && ns === NS.MATHML;\n  }\n\n  return false;\n} //Stack of open elements\n\n\nvar OpenElementStack = module.exports = function (document, treeAdapter) {\n  this.stackTop = -1;\n  this.items = [];\n  this.current = document;\n  this.currentTagName = null;\n  this.currentTmplContent = null;\n  this.tmplCount = 0;\n  this.treeAdapter = treeAdapter;\n}; //Index of element\n\n\nOpenElementStack.prototype._indexOf = function (element) {\n  var idx = -1;\n\n  for (var i = this.stackTop; i >= 0; i--) {\n    if (this.items[i] === element) {\n      idx = i;\n      break;\n    }\n  }\n\n  return idx;\n}; //Update current element\n\n\nOpenElementStack.prototype._isInTemplate = function () {\n  return this.currentTagName === $.TEMPLATE && this.treeAdapter.getNamespaceURI(this.current) === NS.HTML;\n};\n\nOpenElementStack.prototype._updateCurrentElement = function () {\n  this.current = this.items[this.stackTop];\n  this.currentTagName = this.current && this.treeAdapter.getTagName(this.current);\n  this.currentTmplContent = this._isInTemplate() ? this.treeAdapter.getTemplateContent(this.current) : null;\n}; //Mutations\n\n\nOpenElementStack.prototype.push = function (element) {\n  this.items[++this.stackTop] = element;\n\n  this._updateCurrentElement();\n\n  if (this._isInTemplate()) this.tmplCount++;\n};\n\nOpenElementStack.prototype.pop = function () {\n  this.stackTop--;\n  if (this.tmplCount > 0 && this._isInTemplate()) this.tmplCount--;\n\n  this._updateCurrentElement();\n};\n\nOpenElementStack.prototype.replace = function (oldElement, newElement) {\n  var idx = this._indexOf(oldElement);\n\n  this.items[idx] = newElement;\n  if (idx === this.stackTop) this._updateCurrentElement();\n};\n\nOpenElementStack.prototype.insertAfter = function (referenceElement, newElement) {\n  var insertionIdx = this._indexOf(referenceElement) + 1;\n  this.items.splice(insertionIdx, 0, newElement);\n  if (insertionIdx === ++this.stackTop) this._updateCurrentElement();\n};\n\nOpenElementStack.prototype.popUntilTagNamePopped = function (tagName) {\n  while (this.stackTop > -1) {\n    var tn = this.currentTagName,\n        ns = this.treeAdapter.getNamespaceURI(this.current);\n    this.pop();\n    if (tn === tagName && ns === NS.HTML) break;\n  }\n};\n\nOpenElementStack.prototype.popUntilElementPopped = function (element) {\n  while (this.stackTop > -1) {\n    var poppedElement = this.current;\n    this.pop();\n    if (poppedElement === element) break;\n  }\n};\n\nOpenElementStack.prototype.popUntilNumberedHeaderPopped = function () {\n  while (this.stackTop > -1) {\n    var tn = this.currentTagName,\n        ns = this.treeAdapter.getNamespaceURI(this.current);\n    this.pop();\n    if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6 && ns === NS.HTML) break;\n  }\n};\n\nOpenElementStack.prototype.popUntilTableCellPopped = function () {\n  while (this.stackTop > -1) {\n    var tn = this.currentTagName,\n        ns = this.treeAdapter.getNamespaceURI(this.current);\n    this.pop();\n    if (tn === $.TD || tn === $.TH && ns === NS.HTML) break;\n  }\n};\n\nOpenElementStack.prototype.popAllUpToHtmlElement = function () {\n  //NOTE: here we assume that root <html> element is always first in the open element stack, so\n  //we perform this fast stack clean up.\n  this.stackTop = 0;\n\n  this._updateCurrentElement();\n};\n\nOpenElementStack.prototype.clearBackToTableContext = function () {\n  while (this.currentTagName !== $.TABLE && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML || this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML) this.pop();\n};\n\nOpenElementStack.prototype.clearBackToTableBodyContext = function () {\n  while (this.currentTagName !== $.TBODY && this.currentTagName !== $.TFOOT && this.currentTagName !== $.THEAD && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML || this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML) this.pop();\n};\n\nOpenElementStack.prototype.clearBackToTableRowContext = function () {\n  while (this.currentTagName !== $.TR && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML || this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML) this.pop();\n};\n\nOpenElementStack.prototype.remove = function (element) {\n  for (var i = this.stackTop; i >= 0; i--) {\n    if (this.items[i] === element) {\n      this.items.splice(i, 1);\n      this.stackTop--;\n\n      this._updateCurrentElement();\n\n      break;\n    }\n  }\n}; //Search\n\n\nOpenElementStack.prototype.tryPeekProperlyNestedBodyElement = function () {\n  //Properly nested <body> element (should be second element in stack).\n  var element = this.items[1];\n  return element && this.treeAdapter.getTagName(element) === $.BODY ? element : null;\n};\n\nOpenElementStack.prototype.contains = function (element) {\n  return this._indexOf(element) > -1;\n};\n\nOpenElementStack.prototype.getCommonAncestor = function (element) {\n  var elementIdx = this._indexOf(element);\n\n  return --elementIdx >= 0 ? this.items[elementIdx] : null;\n};\n\nOpenElementStack.prototype.isRootHtmlElementCurrent = function () {\n  return this.stackTop === 0 && this.currentTagName === $.HTML;\n}; //Element in scope\n\n\nOpenElementStack.prototype.hasInScope = function (tagName) {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]),\n        ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n    if (tn === tagName && ns === NS.HTML) return true;\n    if (isScopingElement(tn, ns)) return false;\n  }\n\n  return true;\n};\n\nOpenElementStack.prototype.hasNumberedHeaderInScope = function () {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]),\n        ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n    if ((tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) && ns === NS.HTML) return true;\n    if (isScopingElement(tn, ns)) return false;\n  }\n\n  return true;\n};\n\nOpenElementStack.prototype.hasInListItemScope = function (tagName) {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]),\n        ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n    if (tn === tagName && ns === NS.HTML) return true;\n    if ((tn === $.UL || tn === $.OL) && ns === NS.HTML || isScopingElement(tn, ns)) return false;\n  }\n\n  return true;\n};\n\nOpenElementStack.prototype.hasInButtonScope = function (tagName) {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]),\n        ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n    if (tn === tagName && ns === NS.HTML) return true;\n    if (tn === $.BUTTON && ns === NS.HTML || isScopingElement(tn, ns)) return false;\n  }\n\n  return true;\n};\n\nOpenElementStack.prototype.hasInTableScope = function (tagName) {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]),\n        ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n    if (ns !== NS.HTML) continue;\n    if (tn === tagName) return true;\n    if (tn === $.TABLE || tn === $.TEMPLATE || tn === $.HTML) return false;\n  }\n\n  return true;\n};\n\nOpenElementStack.prototype.hasTableBodyContextInTableScope = function () {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]),\n        ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n    if (ns !== NS.HTML) continue;\n    if (tn === $.TBODY || tn === $.THEAD || tn === $.TFOOT) return true;\n    if (tn === $.TABLE || tn === $.HTML) return false;\n  }\n\n  return true;\n};\n\nOpenElementStack.prototype.hasInSelectScope = function (tagName) {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]),\n        ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n    if (ns !== NS.HTML) continue;\n    if (tn === tagName) return true;\n    if (tn !== $.OPTION && tn !== $.OPTGROUP) return false;\n  }\n\n  return true;\n}; //Implied end tags\n\n\nOpenElementStack.prototype.generateImpliedEndTags = function () {\n  while (isImpliedEndTagRequired(this.currentTagName)) this.pop();\n};\n\nOpenElementStack.prototype.generateImpliedEndTagsWithExclusion = function (exclusionTagName) {\n  while (isImpliedEndTagRequired(this.currentTagName) && this.currentTagName !== exclusionTagName) this.pop();\n};","map":{"version":3,"sources":["/Users/lambda_school_loaner_244/Desktop/LAMBDA/projects/projectsCollection/node_modules/parse5/lib/parser/open_element_stack.js"],"names":["HTML","require","$","TAG_NAMES","NS","NAMESPACES","isImpliedEndTagRequired","tn","length","P","RB","RP","RT","DD","DT","LI","RTC","OPTION","OPTGROUP","MENUITEM","isScopingElement","ns","TD","TH","MI","MO","MN","MS","MATHML","DESC","SVG","TABLE","MTEXT","TITLE","APPLET","OBJECT","CAPTION","MARQUEE","TEMPLATE","FOREIGN_OBJECT","ANNOTATION_XML","OpenElementStack","module","exports","document","treeAdapter","stackTop","items","current","currentTagName","currentTmplContent","tmplCount","prototype","_indexOf","element","idx","i","_isInTemplate","getNamespaceURI","_updateCurrentElement","getTagName","getTemplateContent","push","pop","replace","oldElement","newElement","insertAfter","referenceElement","insertionIdx","splice","popUntilTagNamePopped","tagName","popUntilElementPopped","poppedElement","popUntilNumberedHeaderPopped","H1","H2","H3","H4","H5","H6","popUntilTableCellPopped","popAllUpToHtmlElement","clearBackToTableContext","clearBackToTableBodyContext","TBODY","TFOOT","THEAD","clearBackToTableRowContext","TR","remove","tryPeekProperlyNestedBodyElement","BODY","contains","getCommonAncestor","elementIdx","isRootHtmlElementCurrent","hasInScope","hasNumberedHeaderInScope","hasInListItemScope","UL","OL","hasInButtonScope","BUTTON","hasInTableScope","hasTableBodyContextInTableScope","hasInSelectScope","generateImpliedEndTags","generateImpliedEndTagsWithExclusion","exclusionTagName"],"mappings":"AAAA;;AAEA,IAAIA,IAAI,GAAGC,OAAO,CAAC,gBAAD,CAAlB,C,CAEA;;;AACA,IAAIC,CAAC,GAAGF,IAAI,CAACG,SAAb;AAAA,IACIC,EAAE,GAAGJ,IAAI,CAACK,UADd,C,CAGA;AAEA;AACA;;AACA,SAASC,uBAAT,CAAiCC,EAAjC,EAAqC;AACjC,UAAQA,EAAE,CAACC,MAAX;AACI,SAAK,CAAL;AACI,aAAOD,EAAE,KAAKL,CAAC,CAACO,CAAhB;;AAEJ,SAAK,CAAL;AACI,aAAOF,EAAE,KAAKL,CAAC,CAACQ,EAAT,IAAeH,EAAE,KAAKL,CAAC,CAACS,EAAxB,IAA8BJ,EAAE,KAAKL,CAAC,CAACU,EAAvC,IAA6CL,EAAE,KAAKL,CAAC,CAACW,EAAtD,IAA4DN,EAAE,KAAKL,CAAC,CAACY,EAArE,IAA2EP,EAAE,KAAKL,CAAC,CAACa,EAA3F;;AAEJ,SAAK,CAAL;AACI,aAAOR,EAAE,KAAKL,CAAC,CAACc,GAAhB;;AAEJ,SAAK,CAAL;AACI,aAAOT,EAAE,KAAKL,CAAC,CAACe,MAAhB;;AAEJ,SAAK,CAAL;AACI,aAAOV,EAAE,KAAKL,CAAC,CAACgB,QAAT,IAAqBX,EAAE,KAAKL,CAAC,CAACiB,QAArC;AAdR;;AAiBA,SAAO,KAAP;AACH;;AAED,SAASC,gBAAT,CAA0Bb,EAA1B,EAA8Bc,EAA9B,EAAkC;AAC9B,UAAQd,EAAE,CAACC,MAAX;AACI,SAAK,CAAL;AACI,UAAID,EAAE,KAAKL,CAAC,CAACoB,EAAT,IAAef,EAAE,KAAKL,CAAC,CAACqB,EAA5B,EACI,OAAOF,EAAE,KAAKjB,EAAE,CAACJ,IAAjB,CADJ,KAGK,IAAIO,EAAE,KAAKL,CAAC,CAACsB,EAAT,IAAejB,EAAE,KAAKL,CAAC,CAACuB,EAAxB,IAA8BlB,EAAE,KAAKL,CAAC,CAACwB,EAAvC,IAA6CnB,EAAE,KAAKL,CAAC,CAACyB,EAA1D,EACD,OAAON,EAAE,KAAKjB,EAAE,CAACwB,MAAjB;AAEJ;;AAEJ,SAAK,CAAL;AACI,UAAIrB,EAAE,KAAKL,CAAC,CAACF,IAAb,EACI,OAAOqB,EAAE,KAAKjB,EAAE,CAACJ,IAAjB,CADJ,KAGK,IAAIO,EAAE,KAAKL,CAAC,CAAC2B,IAAb,EACD,OAAOR,EAAE,KAAKjB,EAAE,CAAC0B,GAAjB;AAEJ;;AAEJ,SAAK,CAAL;AACI,UAAIvB,EAAE,KAAKL,CAAC,CAAC6B,KAAb,EACI,OAAOV,EAAE,KAAKjB,EAAE,CAACJ,IAAjB,CADJ,KAGK,IAAIO,EAAE,KAAKL,CAAC,CAAC8B,KAAb,EACD,OAAOX,EAAE,KAAKjB,EAAE,CAACwB,MAAjB,CADC,KAGA,IAAIrB,EAAE,KAAKL,CAAC,CAAC+B,KAAb,EACD,OAAOZ,EAAE,KAAKjB,EAAE,CAAC0B,GAAjB;AAEJ;;AAEJ,SAAK,CAAL;AACI,aAAO,CAACvB,EAAE,KAAKL,CAAC,CAACgC,MAAT,IAAmB3B,EAAE,KAAKL,CAAC,CAACiC,MAA7B,KAAwCd,EAAE,KAAKjB,EAAE,CAACJ,IAAzD;;AAEJ,SAAK,CAAL;AACI,aAAO,CAACO,EAAE,KAAKL,CAAC,CAACkC,OAAT,IAAoB7B,EAAE,KAAKL,CAAC,CAACmC,OAA9B,KAA0ChB,EAAE,KAAKjB,EAAE,CAACJ,IAA3D;;AAEJ,SAAK,CAAL;AACI,aAAOO,EAAE,KAAKL,CAAC,CAACoC,QAAT,IAAqBjB,EAAE,KAAKjB,EAAE,CAACJ,IAAtC;;AAEJ,SAAK,EAAL;AACI,aAAOO,EAAE,KAAKL,CAAC,CAACqC,cAAT,IAA2BlB,EAAE,KAAKjB,EAAE,CAAC0B,GAA5C;;AAEJ,SAAK,EAAL;AACI,aAAOvB,EAAE,KAAKL,CAAC,CAACsC,cAAT,IAA2BnB,EAAE,KAAKjB,EAAE,CAACwB,MAA5C;AA5CR;;AA+CA,SAAO,KAAP;AACH,C,CAED;;;AACA,IAAIa,gBAAgB,GAAGC,MAAM,CAACC,OAAP,GAAiB,UAAUC,QAAV,EAAoBC,WAApB,EAAiC;AACrE,OAAKC,QAAL,GAAgB,CAAC,CAAjB;AACA,OAAKC,KAAL,GAAa,EAAb;AACA,OAAKC,OAAL,GAAeJ,QAAf;AACA,OAAKK,cAAL,GAAsB,IAAtB;AACA,OAAKC,kBAAL,GAA0B,IAA1B;AACA,OAAKC,SAAL,GAAiB,CAAjB;AACA,OAAKN,WAAL,GAAmBA,WAAnB;AACH,CARD,C,CAUA;;;AACAJ,gBAAgB,CAACW,SAAjB,CAA2BC,QAA3B,GAAsC,UAAUC,OAAV,EAAmB;AACrD,MAAIC,GAAG,GAAG,CAAC,CAAX;;AAEA,OAAK,IAAIC,CAAC,GAAG,KAAKV,QAAlB,EAA4BU,CAAC,IAAI,CAAjC,EAAoCA,CAAC,EAArC,EAAyC;AACrC,QAAI,KAAKT,KAAL,CAAWS,CAAX,MAAkBF,OAAtB,EAA+B;AAC3BC,MAAAA,GAAG,GAAGC,CAAN;AACA;AACH;AACJ;;AACD,SAAOD,GAAP;AACH,CAVD,C,CAYA;;;AACAd,gBAAgB,CAACW,SAAjB,CAA2BK,aAA3B,GAA2C,YAAY;AACnD,SAAO,KAAKR,cAAL,KAAwB/C,CAAC,CAACoC,QAA1B,IAAsC,KAAKO,WAAL,CAAiBa,eAAjB,CAAiC,KAAKV,OAAtC,MAAmD5C,EAAE,CAACJ,IAAnG;AACH,CAFD;;AAIAyC,gBAAgB,CAACW,SAAjB,CAA2BO,qBAA3B,GAAmD,YAAY;AAC3D,OAAKX,OAAL,GAAe,KAAKD,KAAL,CAAW,KAAKD,QAAhB,CAAf;AACA,OAAKG,cAAL,GAAsB,KAAKD,OAAL,IAAgB,KAAKH,WAAL,CAAiBe,UAAjB,CAA4B,KAAKZ,OAAjC,CAAtC;AAEA,OAAKE,kBAAL,GAA0B,KAAKO,aAAL,KAAuB,KAAKZ,WAAL,CAAiBgB,kBAAjB,CAAoC,KAAKb,OAAzC,CAAvB,GAA2E,IAArG;AACH,CALD,C,CAOA;;;AACAP,gBAAgB,CAACW,SAAjB,CAA2BU,IAA3B,GAAkC,UAAUR,OAAV,EAAmB;AACjD,OAAKP,KAAL,CAAW,EAAE,KAAKD,QAAlB,IAA8BQ,OAA9B;;AACA,OAAKK,qBAAL;;AAEA,MAAI,KAAKF,aAAL,EAAJ,EACI,KAAKN,SAAL;AAEP,CAPD;;AASAV,gBAAgB,CAACW,SAAjB,CAA2BW,GAA3B,GAAiC,YAAY;AACzC,OAAKjB,QAAL;AAEA,MAAI,KAAKK,SAAL,GAAiB,CAAjB,IAAsB,KAAKM,aAAL,EAA1B,EACI,KAAKN,SAAL;;AAEJ,OAAKQ,qBAAL;AACH,CAPD;;AASAlB,gBAAgB,CAACW,SAAjB,CAA2BY,OAA3B,GAAqC,UAAUC,UAAV,EAAsBC,UAAtB,EAAkC;AACnE,MAAIX,GAAG,GAAG,KAAKF,QAAL,CAAcY,UAAd,CAAV;;AAEA,OAAKlB,KAAL,CAAWQ,GAAX,IAAkBW,UAAlB;AAEA,MAAIX,GAAG,KAAK,KAAKT,QAAjB,EACI,KAAKa,qBAAL;AACP,CAPD;;AASAlB,gBAAgB,CAACW,SAAjB,CAA2Be,WAA3B,GAAyC,UAAUC,gBAAV,EAA4BF,UAA5B,EAAwC;AAC7E,MAAIG,YAAY,GAAG,KAAKhB,QAAL,CAAce,gBAAd,IAAkC,CAArD;AAEA,OAAKrB,KAAL,CAAWuB,MAAX,CAAkBD,YAAlB,EAAgC,CAAhC,EAAmCH,UAAnC;AAEA,MAAIG,YAAY,KAAK,EAAE,KAAKvB,QAA5B,EACI,KAAKa,qBAAL;AACP,CAPD;;AASAlB,gBAAgB,CAACW,SAAjB,CAA2BmB,qBAA3B,GAAmD,UAAUC,OAAV,EAAmB;AAClE,SAAO,KAAK1B,QAAL,GAAgB,CAAC,CAAxB,EAA2B;AACvB,QAAIvC,EAAE,GAAG,KAAK0C,cAAd;AAAA,QACI5B,EAAE,GAAG,KAAKwB,WAAL,CAAiBa,eAAjB,CAAiC,KAAKV,OAAtC,CADT;AAGA,SAAKe,GAAL;AAEA,QAAIxD,EAAE,KAAKiE,OAAP,IAAkBnD,EAAE,KAAKjB,EAAE,CAACJ,IAAhC,EACI;AACP;AACJ,CAVD;;AAYAyC,gBAAgB,CAACW,SAAjB,CAA2BqB,qBAA3B,GAAmD,UAAUnB,OAAV,EAAmB;AAClE,SAAO,KAAKR,QAAL,GAAgB,CAAC,CAAxB,EAA2B;AACvB,QAAI4B,aAAa,GAAG,KAAK1B,OAAzB;AAEA,SAAKe,GAAL;AAEA,QAAIW,aAAa,KAAKpB,OAAtB,EACI;AACP;AACJ,CATD;;AAWAb,gBAAgB,CAACW,SAAjB,CAA2BuB,4BAA3B,GAA0D,YAAY;AAClE,SAAO,KAAK7B,QAAL,GAAgB,CAAC,CAAxB,EAA2B;AACvB,QAAIvC,EAAE,GAAG,KAAK0C,cAAd;AAAA,QACI5B,EAAE,GAAG,KAAKwB,WAAL,CAAiBa,eAAjB,CAAiC,KAAKV,OAAtC,CADT;AAGA,SAAKe,GAAL;AAEA,QAAIxD,EAAE,KAAKL,CAAC,CAAC0E,EAAT,IAAerE,EAAE,KAAKL,CAAC,CAAC2E,EAAxB,IAA8BtE,EAAE,KAAKL,CAAC,CAAC4E,EAAvC,IAA6CvE,EAAE,KAAKL,CAAC,CAAC6E,EAAtD,IAA4DxE,EAAE,KAAKL,CAAC,CAAC8E,EAArE,IAA2EzE,EAAE,KAAKL,CAAC,CAAC+E,EAAT,IAAe5D,EAAE,KAAKjB,EAAE,CAACJ,IAAxG,EACI;AACP;AACJ,CAVD;;AAYAyC,gBAAgB,CAACW,SAAjB,CAA2B8B,uBAA3B,GAAqD,YAAY;AAC7D,SAAO,KAAKpC,QAAL,GAAgB,CAAC,CAAxB,EAA2B;AACvB,QAAIvC,EAAE,GAAG,KAAK0C,cAAd;AAAA,QACI5B,EAAE,GAAG,KAAKwB,WAAL,CAAiBa,eAAjB,CAAiC,KAAKV,OAAtC,CADT;AAGA,SAAKe,GAAL;AAEA,QAAIxD,EAAE,KAAKL,CAAC,CAACoB,EAAT,IAAef,EAAE,KAAKL,CAAC,CAACqB,EAAT,IAAeF,EAAE,KAAKjB,EAAE,CAACJ,IAA5C,EACI;AACP;AACJ,CAVD;;AAYAyC,gBAAgB,CAACW,SAAjB,CAA2B+B,qBAA3B,GAAmD,YAAY;AAC3D;AACA;AACA,OAAKrC,QAAL,GAAgB,CAAhB;;AACA,OAAKa,qBAAL;AACH,CALD;;AAOAlB,gBAAgB,CAACW,SAAjB,CAA2BgC,uBAA3B,GAAqD,YAAY;AAC7D,SAAO,KAAKnC,cAAL,KAAwB/C,CAAC,CAAC6B,KAA1B,IACA,KAAKkB,cAAL,KAAwB/C,CAAC,CAACoC,QAD1B,IAEA,KAAKW,cAAL,KAAwB/C,CAAC,CAACF,IAF1B,IAGA,KAAK6C,WAAL,CAAiBa,eAAjB,CAAiC,KAAKV,OAAtC,MAAmD5C,EAAE,CAACJ,IAH7D,EAII,KAAK+D,GAAL;AACP,CAND;;AAQAtB,gBAAgB,CAACW,SAAjB,CAA2BiC,2BAA3B,GAAyD,YAAY;AACjE,SAAO,KAAKpC,cAAL,KAAwB/C,CAAC,CAACoF,KAA1B,IACA,KAAKrC,cAAL,KAAwB/C,CAAC,CAACqF,KAD1B,IAEA,KAAKtC,cAAL,KAAwB/C,CAAC,CAACsF,KAF1B,IAGA,KAAKvC,cAAL,KAAwB/C,CAAC,CAACoC,QAH1B,IAIA,KAAKW,cAAL,KAAwB/C,CAAC,CAACF,IAJ1B,IAKA,KAAK6C,WAAL,CAAiBa,eAAjB,CAAiC,KAAKV,OAAtC,MAAmD5C,EAAE,CAACJ,IAL7D,EAMI,KAAK+D,GAAL;AACP,CARD;;AAUAtB,gBAAgB,CAACW,SAAjB,CAA2BqC,0BAA3B,GAAwD,YAAY;AAChE,SAAO,KAAKxC,cAAL,KAAwB/C,CAAC,CAACwF,EAA1B,IACA,KAAKzC,cAAL,KAAwB/C,CAAC,CAACoC,QAD1B,IAEA,KAAKW,cAAL,KAAwB/C,CAAC,CAACF,IAF1B,IAGA,KAAK6C,WAAL,CAAiBa,eAAjB,CAAiC,KAAKV,OAAtC,MAAmD5C,EAAE,CAACJ,IAH7D,EAII,KAAK+D,GAAL;AACP,CAND;;AAQAtB,gBAAgB,CAACW,SAAjB,CAA2BuC,MAA3B,GAAoC,UAAUrC,OAAV,EAAmB;AACnD,OAAK,IAAIE,CAAC,GAAG,KAAKV,QAAlB,EAA4BU,CAAC,IAAI,CAAjC,EAAoCA,CAAC,EAArC,EAAyC;AACrC,QAAI,KAAKT,KAAL,CAAWS,CAAX,MAAkBF,OAAtB,EAA+B;AAC3B,WAAKP,KAAL,CAAWuB,MAAX,CAAkBd,CAAlB,EAAqB,CAArB;AACA,WAAKV,QAAL;;AACA,WAAKa,qBAAL;;AACA;AACH;AACJ;AACJ,CATD,C,CAWA;;;AACAlB,gBAAgB,CAACW,SAAjB,CAA2BwC,gCAA3B,GAA8D,YAAY;AACtE;AACA,MAAItC,OAAO,GAAG,KAAKP,KAAL,CAAW,CAAX,CAAd;AAEA,SAAOO,OAAO,IAAI,KAAKT,WAAL,CAAiBe,UAAjB,CAA4BN,OAA5B,MAAyCpD,CAAC,CAAC2F,IAAtD,GAA6DvC,OAA7D,GAAuE,IAA9E;AACH,CALD;;AAOAb,gBAAgB,CAACW,SAAjB,CAA2B0C,QAA3B,GAAsC,UAAUxC,OAAV,EAAmB;AACrD,SAAO,KAAKD,QAAL,CAAcC,OAAd,IAAyB,CAAC,CAAjC;AACH,CAFD;;AAIAb,gBAAgB,CAACW,SAAjB,CAA2B2C,iBAA3B,GAA+C,UAAUzC,OAAV,EAAmB;AAC9D,MAAI0C,UAAU,GAAG,KAAK3C,QAAL,CAAcC,OAAd,CAAjB;;AAEA,SAAO,EAAE0C,UAAF,IAAgB,CAAhB,GAAoB,KAAKjD,KAAL,CAAWiD,UAAX,CAApB,GAA6C,IAApD;AACH,CAJD;;AAMAvD,gBAAgB,CAACW,SAAjB,CAA2B6C,wBAA3B,GAAsD,YAAY;AAC9D,SAAO,KAAKnD,QAAL,KAAkB,CAAlB,IAAuB,KAAKG,cAAL,KAAwB/C,CAAC,CAACF,IAAxD;AACH,CAFD,C,CAIA;;;AACAyC,gBAAgB,CAACW,SAAjB,CAA2B8C,UAA3B,GAAwC,UAAU1B,OAAV,EAAmB;AACvD,OAAK,IAAIhB,CAAC,GAAG,KAAKV,QAAlB,EAA4BU,CAAC,IAAI,CAAjC,EAAoCA,CAAC,EAArC,EAAyC;AACrC,QAAIjD,EAAE,GAAG,KAAKsC,WAAL,CAAiBe,UAAjB,CAA4B,KAAKb,KAAL,CAAWS,CAAX,CAA5B,CAAT;AAAA,QACInC,EAAE,GAAG,KAAKwB,WAAL,CAAiBa,eAAjB,CAAiC,KAAKX,KAAL,CAAWS,CAAX,CAAjC,CADT;AAGA,QAAIjD,EAAE,KAAKiE,OAAP,IAAkBnD,EAAE,KAAKjB,EAAE,CAACJ,IAAhC,EACI,OAAO,IAAP;AAEJ,QAAIoB,gBAAgB,CAACb,EAAD,EAAKc,EAAL,CAApB,EACI,OAAO,KAAP;AACP;;AAED,SAAO,IAAP;AACH,CAbD;;AAeAoB,gBAAgB,CAACW,SAAjB,CAA2B+C,wBAA3B,GAAsD,YAAY;AAC9D,OAAK,IAAI3C,CAAC,GAAG,KAAKV,QAAlB,EAA4BU,CAAC,IAAI,CAAjC,EAAoCA,CAAC,EAArC,EAAyC;AACrC,QAAIjD,EAAE,GAAG,KAAKsC,WAAL,CAAiBe,UAAjB,CAA4B,KAAKb,KAAL,CAAWS,CAAX,CAA5B,CAAT;AAAA,QACInC,EAAE,GAAG,KAAKwB,WAAL,CAAiBa,eAAjB,CAAiC,KAAKX,KAAL,CAAWS,CAAX,CAAjC,CADT;AAGA,QAAI,CAACjD,EAAE,KAAKL,CAAC,CAAC0E,EAAT,IAAerE,EAAE,KAAKL,CAAC,CAAC2E,EAAxB,IAA8BtE,EAAE,KAAKL,CAAC,CAAC4E,EAAvC,IAA6CvE,EAAE,KAAKL,CAAC,CAAC6E,EAAtD,IAA4DxE,EAAE,KAAKL,CAAC,CAAC8E,EAArE,IAA2EzE,EAAE,KAAKL,CAAC,CAAC+E,EAArF,KAA4F5D,EAAE,KAAKjB,EAAE,CAACJ,IAA1G,EACI,OAAO,IAAP;AAEJ,QAAIoB,gBAAgB,CAACb,EAAD,EAAKc,EAAL,CAApB,EACI,OAAO,KAAP;AACP;;AAED,SAAO,IAAP;AACH,CAbD;;AAeAoB,gBAAgB,CAACW,SAAjB,CAA2BgD,kBAA3B,GAAgD,UAAU5B,OAAV,EAAmB;AAC/D,OAAK,IAAIhB,CAAC,GAAG,KAAKV,QAAlB,EAA4BU,CAAC,IAAI,CAAjC,EAAoCA,CAAC,EAArC,EAAyC;AACrC,QAAIjD,EAAE,GAAG,KAAKsC,WAAL,CAAiBe,UAAjB,CAA4B,KAAKb,KAAL,CAAWS,CAAX,CAA5B,CAAT;AAAA,QACInC,EAAE,GAAG,KAAKwB,WAAL,CAAiBa,eAAjB,CAAiC,KAAKX,KAAL,CAAWS,CAAX,CAAjC,CADT;AAGA,QAAIjD,EAAE,KAAKiE,OAAP,IAAkBnD,EAAE,KAAKjB,EAAE,CAACJ,IAAhC,EACI,OAAO,IAAP;AAEJ,QAAI,CAACO,EAAE,KAAKL,CAAC,CAACmG,EAAT,IAAe9F,EAAE,KAAKL,CAAC,CAACoG,EAAzB,KAAgCjF,EAAE,KAAKjB,EAAE,CAACJ,IAA1C,IAAkDoB,gBAAgB,CAACb,EAAD,EAAKc,EAAL,CAAtE,EACI,OAAO,KAAP;AACP;;AAED,SAAO,IAAP;AACH,CAbD;;AAeAoB,gBAAgB,CAACW,SAAjB,CAA2BmD,gBAA3B,GAA8C,UAAU/B,OAAV,EAAmB;AAC7D,OAAK,IAAIhB,CAAC,GAAG,KAAKV,QAAlB,EAA4BU,CAAC,IAAI,CAAjC,EAAoCA,CAAC,EAArC,EAAyC;AACrC,QAAIjD,EAAE,GAAG,KAAKsC,WAAL,CAAiBe,UAAjB,CAA4B,KAAKb,KAAL,CAAWS,CAAX,CAA5B,CAAT;AAAA,QACInC,EAAE,GAAG,KAAKwB,WAAL,CAAiBa,eAAjB,CAAiC,KAAKX,KAAL,CAAWS,CAAX,CAAjC,CADT;AAGA,QAAIjD,EAAE,KAAKiE,OAAP,IAAkBnD,EAAE,KAAKjB,EAAE,CAACJ,IAAhC,EACI,OAAO,IAAP;AAEJ,QAAIO,EAAE,KAAKL,CAAC,CAACsG,MAAT,IAAmBnF,EAAE,KAAKjB,EAAE,CAACJ,IAA7B,IAAqCoB,gBAAgB,CAACb,EAAD,EAAKc,EAAL,CAAzD,EACI,OAAO,KAAP;AACP;;AAED,SAAO,IAAP;AACH,CAbD;;AAeAoB,gBAAgB,CAACW,SAAjB,CAA2BqD,eAA3B,GAA6C,UAAUjC,OAAV,EAAmB;AAC5D,OAAK,IAAIhB,CAAC,GAAG,KAAKV,QAAlB,EAA4BU,CAAC,IAAI,CAAjC,EAAoCA,CAAC,EAArC,EAAyC;AACrC,QAAIjD,EAAE,GAAG,KAAKsC,WAAL,CAAiBe,UAAjB,CAA4B,KAAKb,KAAL,CAAWS,CAAX,CAA5B,CAAT;AAAA,QACInC,EAAE,GAAG,KAAKwB,WAAL,CAAiBa,eAAjB,CAAiC,KAAKX,KAAL,CAAWS,CAAX,CAAjC,CADT;AAGA,QAAInC,EAAE,KAAKjB,EAAE,CAACJ,IAAd,EACI;AAEJ,QAAIO,EAAE,KAAKiE,OAAX,EACI,OAAO,IAAP;AAEJ,QAAIjE,EAAE,KAAKL,CAAC,CAAC6B,KAAT,IAAkBxB,EAAE,KAAKL,CAAC,CAACoC,QAA3B,IAAuC/B,EAAE,KAAKL,CAAC,CAACF,IAApD,EACI,OAAO,KAAP;AACP;;AAED,SAAO,IAAP;AACH,CAhBD;;AAkBAyC,gBAAgB,CAACW,SAAjB,CAA2BsD,+BAA3B,GAA6D,YAAY;AACrE,OAAK,IAAIlD,CAAC,GAAG,KAAKV,QAAlB,EAA4BU,CAAC,IAAI,CAAjC,EAAoCA,CAAC,EAArC,EAAyC;AACrC,QAAIjD,EAAE,GAAG,KAAKsC,WAAL,CAAiBe,UAAjB,CAA4B,KAAKb,KAAL,CAAWS,CAAX,CAA5B,CAAT;AAAA,QACInC,EAAE,GAAG,KAAKwB,WAAL,CAAiBa,eAAjB,CAAiC,KAAKX,KAAL,CAAWS,CAAX,CAAjC,CADT;AAGA,QAAInC,EAAE,KAAKjB,EAAE,CAACJ,IAAd,EACI;AAEJ,QAAIO,EAAE,KAAKL,CAAC,CAACoF,KAAT,IAAkB/E,EAAE,KAAKL,CAAC,CAACsF,KAA3B,IAAoCjF,EAAE,KAAKL,CAAC,CAACqF,KAAjD,EACI,OAAO,IAAP;AAEJ,QAAIhF,EAAE,KAAKL,CAAC,CAAC6B,KAAT,IAAkBxB,EAAE,KAAKL,CAAC,CAACF,IAA/B,EACI,OAAO,KAAP;AACP;;AAED,SAAO,IAAP;AACH,CAhBD;;AAkBAyC,gBAAgB,CAACW,SAAjB,CAA2BuD,gBAA3B,GAA8C,UAAUnC,OAAV,EAAmB;AAC7D,OAAK,IAAIhB,CAAC,GAAG,KAAKV,QAAlB,EAA4BU,CAAC,IAAI,CAAjC,EAAoCA,CAAC,EAArC,EAAyC;AACrC,QAAIjD,EAAE,GAAG,KAAKsC,WAAL,CAAiBe,UAAjB,CAA4B,KAAKb,KAAL,CAAWS,CAAX,CAA5B,CAAT;AAAA,QACInC,EAAE,GAAG,KAAKwB,WAAL,CAAiBa,eAAjB,CAAiC,KAAKX,KAAL,CAAWS,CAAX,CAAjC,CADT;AAGA,QAAInC,EAAE,KAAKjB,EAAE,CAACJ,IAAd,EACI;AAEJ,QAAIO,EAAE,KAAKiE,OAAX,EACI,OAAO,IAAP;AAEJ,QAAIjE,EAAE,KAAKL,CAAC,CAACe,MAAT,IAAmBV,EAAE,KAAKL,CAAC,CAACgB,QAAhC,EACI,OAAO,KAAP;AACP;;AAED,SAAO,IAAP;AACH,CAhBD,C,CAkBA;;;AACAuB,gBAAgB,CAACW,SAAjB,CAA2BwD,sBAA3B,GAAoD,YAAY;AAC5D,SAAOtG,uBAAuB,CAAC,KAAK2C,cAAN,CAA9B,EACI,KAAKc,GAAL;AACP,CAHD;;AAKAtB,gBAAgB,CAACW,SAAjB,CAA2ByD,mCAA3B,GAAiE,UAAUC,gBAAV,EAA4B;AACzF,SAAOxG,uBAAuB,CAAC,KAAK2C,cAAN,CAAvB,IAAgD,KAAKA,cAAL,KAAwB6D,gBAA/E,EACI,KAAK/C,GAAL;AACP,CAHD","sourcesContent":["'use strict';\n\nvar HTML = require('../common/html');\n\n//Aliases\nvar $ = HTML.TAG_NAMES,\n    NS = HTML.NAMESPACES;\n\n//Element utils\n\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\n//It's faster than using dictionary.\nfunction isImpliedEndTagRequired(tn) {\n    switch (tn.length) {\n        case 1:\n            return tn === $.P;\n\n        case 2:\n            return tn === $.RB || tn === $.RP || tn === $.RT || tn === $.DD || tn === $.DT || tn === $.LI;\n\n        case 3:\n            return tn === $.RTC;\n\n        case 6:\n            return tn === $.OPTION;\n\n        case 8:\n            return tn === $.OPTGROUP || tn === $.MENUITEM;\n    }\n\n    return false;\n}\n\nfunction isScopingElement(tn, ns) {\n    switch (tn.length) {\n        case 2:\n            if (tn === $.TD || tn === $.TH)\n                return ns === NS.HTML;\n\n            else if (tn === $.MI || tn === $.MO || tn === $.MN || tn === $.MS)\n                return ns === NS.MATHML;\n\n            break;\n\n        case 4:\n            if (tn === $.HTML)\n                return ns === NS.HTML;\n\n            else if (tn === $.DESC)\n                return ns === NS.SVG;\n\n            break;\n\n        case 5:\n            if (tn === $.TABLE)\n                return ns === NS.HTML;\n\n            else if (tn === $.MTEXT)\n                return ns === NS.MATHML;\n\n            else if (tn === $.TITLE)\n                return ns === NS.SVG;\n\n            break;\n\n        case 6:\n            return (tn === $.APPLET || tn === $.OBJECT) && ns === NS.HTML;\n\n        case 7:\n            return (tn === $.CAPTION || tn === $.MARQUEE) && ns === NS.HTML;\n\n        case 8:\n            return tn === $.TEMPLATE && ns === NS.HTML;\n\n        case 13:\n            return tn === $.FOREIGN_OBJECT && ns === NS.SVG;\n\n        case 14:\n            return tn === $.ANNOTATION_XML && ns === NS.MATHML;\n    }\n\n    return false;\n}\n\n//Stack of open elements\nvar OpenElementStack = module.exports = function (document, treeAdapter) {\n    this.stackTop = -1;\n    this.items = [];\n    this.current = document;\n    this.currentTagName = null;\n    this.currentTmplContent = null;\n    this.tmplCount = 0;\n    this.treeAdapter = treeAdapter;\n};\n\n//Index of element\nOpenElementStack.prototype._indexOf = function (element) {\n    var idx = -1;\n\n    for (var i = this.stackTop; i >= 0; i--) {\n        if (this.items[i] === element) {\n            idx = i;\n            break;\n        }\n    }\n    return idx;\n};\n\n//Update current element\nOpenElementStack.prototype._isInTemplate = function () {\n    return this.currentTagName === $.TEMPLATE && this.treeAdapter.getNamespaceURI(this.current) === NS.HTML;\n};\n\nOpenElementStack.prototype._updateCurrentElement = function () {\n    this.current = this.items[this.stackTop];\n    this.currentTagName = this.current && this.treeAdapter.getTagName(this.current);\n\n    this.currentTmplContent = this._isInTemplate() ? this.treeAdapter.getTemplateContent(this.current) : null;\n};\n\n//Mutations\nOpenElementStack.prototype.push = function (element) {\n    this.items[++this.stackTop] = element;\n    this._updateCurrentElement();\n\n    if (this._isInTemplate())\n        this.tmplCount++;\n\n};\n\nOpenElementStack.prototype.pop = function () {\n    this.stackTop--;\n\n    if (this.tmplCount > 0 && this._isInTemplate())\n        this.tmplCount--;\n\n    this._updateCurrentElement();\n};\n\nOpenElementStack.prototype.replace = function (oldElement, newElement) {\n    var idx = this._indexOf(oldElement);\n\n    this.items[idx] = newElement;\n\n    if (idx === this.stackTop)\n        this._updateCurrentElement();\n};\n\nOpenElementStack.prototype.insertAfter = function (referenceElement, newElement) {\n    var insertionIdx = this._indexOf(referenceElement) + 1;\n\n    this.items.splice(insertionIdx, 0, newElement);\n\n    if (insertionIdx === ++this.stackTop)\n        this._updateCurrentElement();\n};\n\nOpenElementStack.prototype.popUntilTagNamePopped = function (tagName) {\n    while (this.stackTop > -1) {\n        var tn = this.currentTagName,\n            ns = this.treeAdapter.getNamespaceURI(this.current);\n\n        this.pop();\n\n        if (tn === tagName && ns === NS.HTML)\n            break;\n    }\n};\n\nOpenElementStack.prototype.popUntilElementPopped = function (element) {\n    while (this.stackTop > -1) {\n        var poppedElement = this.current;\n\n        this.pop();\n\n        if (poppedElement === element)\n            break;\n    }\n};\n\nOpenElementStack.prototype.popUntilNumberedHeaderPopped = function () {\n    while (this.stackTop > -1) {\n        var tn = this.currentTagName,\n            ns = this.treeAdapter.getNamespaceURI(this.current);\n\n        this.pop();\n\n        if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6 && ns === NS.HTML)\n            break;\n    }\n};\n\nOpenElementStack.prototype.popUntilTableCellPopped = function () {\n    while (this.stackTop > -1) {\n        var tn = this.currentTagName,\n            ns = this.treeAdapter.getNamespaceURI(this.current);\n\n        this.pop();\n\n        if (tn === $.TD || tn === $.TH && ns === NS.HTML)\n            break;\n    }\n};\n\nOpenElementStack.prototype.popAllUpToHtmlElement = function () {\n    //NOTE: here we assume that root <html> element is always first in the open element stack, so\n    //we perform this fast stack clean up.\n    this.stackTop = 0;\n    this._updateCurrentElement();\n};\n\nOpenElementStack.prototype.clearBackToTableContext = function () {\n    while (this.currentTagName !== $.TABLE &&\n           this.currentTagName !== $.TEMPLATE &&\n           this.currentTagName !== $.HTML ||\n           this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML)\n        this.pop();\n};\n\nOpenElementStack.prototype.clearBackToTableBodyContext = function () {\n    while (this.currentTagName !== $.TBODY &&\n           this.currentTagName !== $.TFOOT &&\n           this.currentTagName !== $.THEAD &&\n           this.currentTagName !== $.TEMPLATE &&\n           this.currentTagName !== $.HTML ||\n           this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML)\n        this.pop();\n};\n\nOpenElementStack.prototype.clearBackToTableRowContext = function () {\n    while (this.currentTagName !== $.TR &&\n           this.currentTagName !== $.TEMPLATE &&\n           this.currentTagName !== $.HTML ||\n           this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML)\n        this.pop();\n};\n\nOpenElementStack.prototype.remove = function (element) {\n    for (var i = this.stackTop; i >= 0; i--) {\n        if (this.items[i] === element) {\n            this.items.splice(i, 1);\n            this.stackTop--;\n            this._updateCurrentElement();\n            break;\n        }\n    }\n};\n\n//Search\nOpenElementStack.prototype.tryPeekProperlyNestedBodyElement = function () {\n    //Properly nested <body> element (should be second element in stack).\n    var element = this.items[1];\n\n    return element && this.treeAdapter.getTagName(element) === $.BODY ? element : null;\n};\n\nOpenElementStack.prototype.contains = function (element) {\n    return this._indexOf(element) > -1;\n};\n\nOpenElementStack.prototype.getCommonAncestor = function (element) {\n    var elementIdx = this._indexOf(element);\n\n    return --elementIdx >= 0 ? this.items[elementIdx] : null;\n};\n\nOpenElementStack.prototype.isRootHtmlElementCurrent = function () {\n    return this.stackTop === 0 && this.currentTagName === $.HTML;\n};\n\n//Element in scope\nOpenElementStack.prototype.hasInScope = function (tagName) {\n    for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]),\n            ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if (tn === tagName && ns === NS.HTML)\n            return true;\n\n        if (isScopingElement(tn, ns))\n            return false;\n    }\n\n    return true;\n};\n\nOpenElementStack.prototype.hasNumberedHeaderInScope = function () {\n    for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]),\n            ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if ((tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) && ns === NS.HTML)\n            return true;\n\n        if (isScopingElement(tn, ns))\n            return false;\n    }\n\n    return true;\n};\n\nOpenElementStack.prototype.hasInListItemScope = function (tagName) {\n    for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]),\n            ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if (tn === tagName && ns === NS.HTML)\n            return true;\n\n        if ((tn === $.UL || tn === $.OL) && ns === NS.HTML || isScopingElement(tn, ns))\n            return false;\n    }\n\n    return true;\n};\n\nOpenElementStack.prototype.hasInButtonScope = function (tagName) {\n    for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]),\n            ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if (tn === tagName && ns === NS.HTML)\n            return true;\n\n        if (tn === $.BUTTON && ns === NS.HTML || isScopingElement(tn, ns))\n            return false;\n    }\n\n    return true;\n};\n\nOpenElementStack.prototype.hasInTableScope = function (tagName) {\n    for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]),\n            ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if (ns !== NS.HTML)\n            continue;\n\n        if (tn === tagName)\n            return true;\n\n        if (tn === $.TABLE || tn === $.TEMPLATE || tn === $.HTML)\n            return false;\n    }\n\n    return true;\n};\n\nOpenElementStack.prototype.hasTableBodyContextInTableScope = function () {\n    for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]),\n            ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if (ns !== NS.HTML)\n            continue;\n\n        if (tn === $.TBODY || tn === $.THEAD || tn === $.TFOOT)\n            return true;\n\n        if (tn === $.TABLE || tn === $.HTML)\n            return false;\n    }\n\n    return true;\n};\n\nOpenElementStack.prototype.hasInSelectScope = function (tagName) {\n    for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]),\n            ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if (ns !== NS.HTML)\n            continue;\n\n        if (tn === tagName)\n            return true;\n\n        if (tn !== $.OPTION && tn !== $.OPTGROUP)\n            return false;\n    }\n\n    return true;\n};\n\n//Implied end tags\nOpenElementStack.prototype.generateImpliedEndTags = function () {\n    while (isImpliedEndTagRequired(this.currentTagName))\n        this.pop();\n};\n\nOpenElementStack.prototype.generateImpliedEndTagsWithExclusion = function (exclusionTagName) {\n    while (isImpliedEndTagRequired(this.currentTagName) && this.currentTagName !== exclusionTagName)\n        this.pop();\n};\n"]},"metadata":{},"sourceType":"script"}